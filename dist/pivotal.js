// Generated by CoffeeScript 1.4.0
(function() {
  var pivotal, request, _,
    __slice = [].slice;

  request = require("request");

  _ = require('underscore')._;

  pivotal = {
    call: function() {
      var args, baseUrl, method, token;
      baseUrl = arguments[0], token = arguments[1], method = arguments[2], args = 4 <= arguments.length ? __slice.call(arguments, 3) : [];
      return pivotal[method].apply(pivotal, [baseUrl, token].concat(__slice.call(args)));
    },
    get: function(baseUrl, token, path, qs, cb) {
      if (cb == null) {
        cb = function() {};
      }
      return request.get("" + baseUrl + path, {
        qs: qs,
        headers: {
          "X-TrackerToken": token
        }
      }, function(err, response, body) {
        return cb(err, body);
      });
    },
    filter: function(props) {
      var k, quote, toArray, v;
      quote = function(value) {
        var shouldQuote;
        shouldQuote = _.any([" ", "-", "_"], function(char) {
          return value.indexOf(char) !== -1;
        });
        if (shouldQuote) {
          return "\"" + value + "\"";
        } else {
          return value;
        }
      };
      toArray = function(v) {
        if (_.isArray(v)) {
          return v;
        } else {
          return [v];
        }
      };
      return ((function() {
        var _results;
        _results = [];
        for (k in props) {
          v = props[k];
          _results.push(k + ":" + (_.map(toArray(v), quote)).join(","));
        }
        return _results;
      })()).join(" ");
    }
  };

  module.exports = pivotal;

}).call(this);
